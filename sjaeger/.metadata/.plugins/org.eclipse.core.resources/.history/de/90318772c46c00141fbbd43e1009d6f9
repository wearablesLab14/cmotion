package de.freiburg.ese.cmotion.smartwatch;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.SocketException;
import java.net.UnknownHostException;
import java.nio.ByteBuffer;

import android.os.AsyncTask;

public class SendQuaternionUDPTask extends AsyncTask<Object, Void, Void> {

	protected Void doInBackground(Object... params) {

		float[] quaternion = (float[]) params[0];
		String broadcastUriString = (String) params[1];
		int destPort = (Integer) params[2];
		
		try {
			DatagramSocket s;
			s = new DatagramSocket();
			InetAddress local = InetAddress.getByName(broadcastUriString);

			int msgLength = quaternion.length;
			byte[] message = floatArray2ByteArray(quaternion);
			msgLength = message.length;
			DatagramPacket p = new DatagramPacket(message, msgLength, local,
					destPort);
			s.send(p);

		} catch (SocketException e) {
			e.printStackTrace();
		} catch (UnknownHostException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}

	}
	
	public byte[] floatArray2ByteArray(float[] values){
        ByteBuffer buffer = ByteBuffer.allocate(4 * values.length);

        for (float value : values){
            buffer.putFloat(value);
        }

        return buffer.array();
    }

	
	
}
